var DeviceOrientationController=function(e,t,n,i){this.object=e,this.element=t||document,this.preventDefault="boolean"!=typeof n||n,this.stopPropagation="boolean"!=typeof i||i,this.freeze=!0,this.enableManualDrag=!0,this.enableManualZoom=!0,this.useQuaternions=!0,this.deviceOrientation={},this.screenOrientation=window.orientation||0;var o,s,a,r,h,u=0,c=0,d=0,E=0,T=new THREE.Quaternion,O=1,m=1,v=new THREE.Vector2,M=new THREE.Vector2,l={AUTO:0,MANUAL_ROTATE:1,MANUAL_ZOOM:2},p=l.AUTO,R={CALIBRATE_COMPASS:"compassneedscalibration",SCREEN_ORIENTATION:"orientationchange",MANUAL_CONTROL:"userinteraction",ZOOM_CONTROL:"zoom",ROTATE_CONTROL:"rotate"},w=window.innerHeight,A=2e3*Math.tan(THREE.Math.degToRad((this.object.fov||75)/2)),L=new THREE.Quaternion,f=function(){var e;return function(t){e=arguments||{},e.type=t,e.target=this,this.dispatchEvent(e)}.bind(this)}.bind(this)();this.constrainObjectFOV=function(){r=A*(window.innerHeight/w),h=THREE.Math.radToDeg(2*Math.atan(r/2e3)),this.object.fov=h}.bind(this),this.onDeviceOrientationChange=function(e){this.deviceOrientation=e}.bind(this),this.onScreenOrientationChange=function(){this.screenOrientation=window.orientation||0,f(R.SCREEN_ORIENTATION)}.bind(this),this.onCompassNeedsCalibration=function(e){this.preventDefault&&e.preventDefault(),f(R.CALIBRATE_COMPASS)}.bind(this),this.onDocumentMouseDown=function(e){this.enableManualDrag===!0&&(this.preventDefault&&e.preventDefault(),p=l.MANUAL_ROTATE,this.freeze=!0,T.copy(this.object.quaternion),u=d=e.pageX,c=E=e.pageY,o=1200/window.innerWidth*.2,s=800/window.innerHeight*.2,this.element.addEventListener("mousemove",this.onDocumentMouseMove,!1),this.element.addEventListener("mouseup",this.onDocumentMouseUp,!1),f(R.MANUAL_CONTROL+"start"),f(R.ROTATE_CONTROL+"start"))}.bind(this),this.onDocumentMouseMove=function(e){d=e.pageX,E=e.pageY}.bind(this),this.onDocumentMouseUp=function(e){this.element.removeEventListener("mousemove",this.onDocumentMouseMove,!1),this.element.removeEventListener("mouseup",this.onDocumentMouseUp,!1),p=l.AUTO,this.freeze=!1,f(R.MANUAL_CONTROL+"end"),f(R.ROTATE_CONTROL+"end")}.bind(this),this.onDocumentTouchStart=function(e){switch(this.preventDefault&&e.preventDefault(),this.stopPropagation&&e.stopPropagation(),e.touches.length){case 1:if(this.enableManualDrag!==!0)return;p=l.MANUAL_ROTATE,this.freeze=!0,T.copy(this.object.quaternion),u=d=e.touches[0].pageX,c=E=e.touches[0].pageY,o=1200/window.innerWidth*.1,s=800/window.innerHeight*.1,this.element.addEventListener("touchmove",this.onDocumentTouchMove,!1),this.element.addEventListener("touchend",this.onDocumentTouchEnd,!1),f(R.MANUAL_CONTROL+"start"),f(R.ROTATE_CONTROL+"start");break;case 2:if(this.enableManualZoom!==!0)return;p=l.MANUAL_ZOOM,this.freeze=!0,a=this.object.fov,v.set(e.touches[0].pageX,e.touches[0].pageY),M.set(e.touches[1].pageX,e.touches[1].pageY),O=m=v.distanceTo(M),this.element.addEventListener("touchmove",this.onDocumentTouchMove,!1),this.element.addEventListener("touchend",this.onDocumentTouchEnd,!1),f(R.MANUAL_CONTROL+"start"),f(R.ZOOM_CONTROL+"start")}}.bind(this),this.onDocumentTouchMove=function(e){switch(e.touches.length){case 1:d=e.touches[0].pageX,E=e.touches[0].pageY;break;case 2:v.set(e.touches[0].pageX,e.touches[0].pageY),M.set(e.touches[1].pageX,e.touches[1].pageY)}}.bind(this),this.onDocumentTouchEnd=function(e){this.element.removeEventListener("touchmove",this.onDocumentTouchMove,!1),this.element.removeEventListener("touchend",this.onDocumentTouchEnd,!1),p===l.MANUAL_ROTATE?(p=l.AUTO,this.freeze=!1,f(R.MANUAL_CONTROL+"end"),f(R.ROTATE_CONTROL+"end")):p===l.MANUAL_ZOOM&&(this.constrainObjectFOV(),p=l.AUTO,this.freeze=!1,f(R.MANUAL_CONTROL+"end"),f(R.ZOOM_CONTROL+"end"))}.bind(this);var g=function(){var e=new THREE.Quaternion,t=new THREE.Euler,n=new THREE.Quaternion,i=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),o=0;return function(s,a,r,h){return t.set(a,s,-r,"YXZ"),e.setFromEuler(t),o=-h/2,n.set(0,Math.sin(o),0,Math.cos(o)),e.multiply(n),e.multiply(i),e}}(),b=function(){var e=new THREE.Matrix4,t=new THREE.Euler,n=new THREE.Euler,i=new THREE.Euler(-Math.PI/2,0,0,"YXZ"),o=new THREE.Matrix4,s=new THREE.Matrix4;return s.makeRotationFromEuler(i),function(i,a,r,h){return t.set(a,i,-r,"YXZ"),e.identity(),e.makeRotationFromEuler(t),n.set(0,-h,0,"YXZ"),o.identity(),o.makeRotationFromEuler(n),e.multiply(o),e.multiply(s),e}}();this.updateManualMove=function(){var e,t,n,i,r,h,R,w,A=new THREE.Euler(0,0,0,"YXZ"),f=new THREE.Quaternion,g=new THREE.Quaternion,b=1;return function(){g.copy(T),p===l.MANUAL_ROTATE?(e=(c-E)*s,t=(u-d)*o,n=THREE.Math.degToRad(e),i=THREE.Math.degToRad(t),f.set(0,Math.sin(i/2),0,Math.cos(i/2)),g.multiply(f),f.set(Math.sin(n/2),0,0,Math.cos(n/2)),g.multiply(f),r=A.setFromQuaternion(T,"YXZ").z,h=A.setFromQuaternion(g,"YXZ").z,R=A.setFromQuaternion(L||T,"YXZ").z,f.set(0,0,Math.sin((R-r)/2),Math.cos((R-r)/2)),T.multiply(f),f.set(0,0,Math.sin((R-h)/2),Math.cos((R-h)/2)),g.multiply(f),this.object.quaternion.copy(g)):p===l.MANUAL_ZOOM&&(m=v.distanceTo(M),w=O/m,w<=b&&(this.object.fov=a*w,this.object.updateProjectionMatrix()),L&&(r=A.setFromQuaternion(T,"YXZ").z,R=A.setFromQuaternion(L,"YXZ").z,f.set(0,0,Math.sin((R-r)/2),Math.cos((R-r)/2)),T.multiply(f),this.object.quaternion.copy(T)))}}(),this.updateDeviceMove=function(){var e,t,n,i,o;return function(){if(e=THREE.Math.degToRad(this.deviceOrientation.alpha||0),t=THREE.Math.degToRad(this.deviceOrientation.beta||0),n=THREE.Math.degToRad(this.deviceOrientation.gamma||0),i=THREE.Math.degToRad(this.screenOrientation||0),0!==e&&0!==t&&0!==n){if(this.useQuaternions?L=g(e,t,n,i):(o=b(e,t,n,i),L.setFromRotationMatrix(o)),this.freeze)return;this.object.quaternion.copy(L)}}}(),this.update=function(){this.updateDeviceMove(),p!==l.AUTO&&this.updateManualMove()},this.connect=function(){window.addEventListener("resize",this.constrainObjectFOV,!1),window.addEventListener("orientationchange",this.onScreenOrientationChange,!1),window.addEventListener("deviceorientation",this.onDeviceOrientationChange,!1),window.addEventListener("compassneedscalibration",this.onCompassNeedsCalibration,!1),this.element.addEventListener("mousedown",this.onDocumentMouseDown,!1),this.element.addEventListener("touchstart",this.onDocumentTouchStart,!1),this.freeze=!1},this.disconnect=function(){this.freeze=!0,window.removeEventListener("resize",this.constrainObjectFOV,!1),window.removeEventListener("orientationchange",this.onScreenOrientationChange,!1),window.removeEventListener("deviceorientation",this.onDeviceOrientationChange,!1),window.removeEventListener("compassneedscalibration",this.onCompassNeedsCalibration,!1),this.element.removeEventListener("mousedown",this.onDocumentMouseDown,!1),this.element.removeEventListener("touchstart",this.onDocumentTouchStart,!1)}};DeviceOrientationController.prototype=Object.create(THREE.EventDispatcher.prototype);
//# sourceMappingURL=DeviceOrientationController.js.map