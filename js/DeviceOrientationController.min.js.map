{"version":3,"sources":["DeviceOrientationController.js"],"names":["DeviceOrientationController","object","domElement","preventDefault","stopPropagation","this","element","document","freeze","enableManualDrag","enableManualZoom","useQuaternions","deviceOrientation","screenOrientation","window","orientation","scrollSpeedX","scrollSpeedY","tmpFOV","relativeFOVFrustrumHeight","relativeVerticalFOV","startX","startY","currentX","currentY","tmpQuat","THREE","Quaternion","zoomStart","zoomCurrent","zoomP1","Vector2","zoomP2","CONTROLLER_STATE","AUTO","MANUAL_ROTATE","MANUAL_ZOOM","appState","CONTROLLER_EVENT","CALIBRATE_COMPASS","SCREEN_ORIENTATION","MANUAL_CONTROL","ZOOM_CONTROL","ROTATE_CONTROL","startClientHeight","innerHeight","startFOVFrustrumHeight","Math","tan","degToRad","fov","deviceQuat","fireEvent","eventData","name","arguments","type","target","dispatchEvent","bind","constrainObjectFOV","radToDeg","atan","onDeviceOrientationChange","event","onScreenOrientationChange","onCompassNeedsCalibration","onDocumentMouseDown","copy","quaternion","pageX","pageY","innerWidth","addEventListener","onDocumentMouseMove","onDocumentMouseUp","removeEventListener","onDocumentTouchStart","touches","length","onDocumentTouchMove","onDocumentTouchEnd","set","distanceTo","createQuaternion","finalQuaternion","deviceEuler","Euler","screenTransform","worldTransform","sqrt","minusHalfAngle","alpha","beta","gamma","setFromEuler","sin","cos","multiply","createRotationMatrix","finalMatrix","Matrix4","screenEuler","worldEuler","PI","makeRotationFromEuler","identity","updateManualMove","lat","lon","phi","theta","tmpZ","objZ","realZ","zoomFactor","rotation","rotQuat","objQuat","minZoomFactor","setFromQuaternion","z","updateProjectionMatrix","updateDeviceMove","orient","deviceMatrix","setFromRotationMatrix","update","connect","disconnect","prototype","Object","create","EventDispatcher"],"mappings":"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","file":"DeviceOrientationController.min.js"}